Index: Makefile.in
===================================================================
--- Makefile.in	2007-02-14 01:59:19.000000000 -0500
+++ Makefile.in	2007-02-14 02:06:36.000000000 -0500
@@ -35,11 +35,11 @@
 	@for d in $(SUBDIRS); do (echo "### Making $@ in $$d"; cd $$d; $(MAKE) $@) || exit 1; done
 
 install:
-	$(srcdir)/mkinstalldirs $(bindir) $(sbindir) $(mrbindir) $(mandir)
+	$(srcdir)/mkinstalldirs $(DESTDIR)$(bindir) $(DESTDIR)$(sbindir) $(DESTDIR)$(mandir)
 	@for d in $(SUBDIRS); do (echo "### Making $@ in $$d"; cd $$d; $(MAKE) $@) || exit 1; done
 
 svrinstall:
-	$(srcdir)/mkinstalldirs $(mrbindir)
+	$(srcdir)/mkinstalldirs $(DESTDIR)$(mrbindir)
 	@for d in $(SVRDIRS); do (echo "### Making install in $$d"; cd $$d; $(MAKE) install) || exit 1; done
 
 world: depend all
Index: clients/addusr/Makefile.in
===================================================================
--- clients/addusr/Makefile.in	2007-02-14 01:59:19.000000000 -0500
+++ clients/addusr/Makefile.in	2007-02-14 01:59:59.000000000 -0500
@@ -40,7 +40,7 @@
 depend:
 
 install: all
-	$(INSTALL_PROGRAM) -m 755 addusr $(bindir)
+	$(INSTALL_PROGRAM) -m 755 addusr $(DESTDIR)$(bindir)
 
 $(TARGET): $(OBJS) ../lib/libmrclient.a $(MR_LIBDEP)
 	$(CC) -o $@ $(LDFLAGS) $(OBJS) $(LIBS)
Index: clients/blanche/Makefile.in
===================================================================
--- clients/blanche/Makefile.in	2007-02-14 01:59:20.000000000 -0500
+++ clients/blanche/Makefile.in	2007-02-14 01:59:59.000000000 -0500
@@ -40,7 +40,7 @@
 depend:
 
 install: all
-	$(INSTALL_PROGRAM) blanche $(bindir)
+	$(INSTALL_PROGRAM) blanche $(DESTDIR)$(bindir)
 
 $(TARGET): $(OBJS) ../lib/libmrclient.a $(MR_LIBDEP)
 	$(CC) -o $@ $(LDFLAGS) $(OBJS) $(LIBS)
Index: clients/chfn/Makefile.in
===================================================================
--- clients/chfn/Makefile.in	2007-02-14 01:59:20.000000000 -0500
+++ clients/chfn/Makefile.in	2007-02-14 01:59:59.000000000 -0500
@@ -40,7 +40,7 @@
 depend:
 
 install: all
-	$(INSTALL_PROGRAM) $(TARGET) $(bindir)
+	$(INSTALL_PROGRAM) $(TARGET) $(DESTDIR)$(bindir)
 
 $(TARGET): $(OBJS) ../lib/libmrclient.a $(MR_LIBDEP)
 	$(CC) -o $@ $(LDFLAGS) $@.o $(LIBS)
Index: clients/chpobox/Makefile.in
===================================================================
--- clients/chpobox/Makefile.in	2007-02-14 01:59:20.000000000 -0500
+++ clients/chpobox/Makefile.in	2007-02-14 01:59:59.000000000 -0500
@@ -40,7 +40,7 @@
 depend:
 
 install: all
-	$(INSTALL_PROGRAM) $(TARGET) $(bindir)
+	$(INSTALL_PROGRAM) $(TARGET) $(DESTDIR)$(bindir)
 
 $(TARGET): $(OBJS) ../lib/libmrclient.a $(MR_LIBDEP)
 	$(CC) -o $@ $(LDFLAGS) $@.o $(LIBS)
Index: clients/chsh/Makefile.in
===================================================================
--- clients/chsh/Makefile.in	2007-02-14 01:59:20.000000000 -0500
+++ clients/chsh/Makefile.in	2007-02-14 01:59:59.000000000 -0500
@@ -40,7 +40,7 @@
 depend:
 
 install: all
-	$(INSTALL_PROGRAM) $(TARGET) $(bindir)
+	$(INSTALL_PROGRAM) $(TARGET) $(DESTDIR)$(bindir)
 
 $(TARGET): $(OBJS) ../lib/libmrclient.a $(MR_LIBDEP)
 	$(CC) -o $@ $(LDFLAGS) $@.o $(LIBS)
Index: clients/mailmaint/Makefile.in
===================================================================
--- clients/mailmaint/Makefile.in	2007-02-14 01:59:20.000000000 -0500
+++ clients/mailmaint/Makefile.in	2007-02-14 01:59:59.000000000 -0500
@@ -40,7 +40,7 @@
 depend:
 
 install: all
-	$(INSTALL_PROGRAM) mailmaint $(bindir)
+	$(INSTALL_PROGRAM) mailmaint $(DESTDIR)$(bindir)
 
 $(TARGET): $(OBJS) ../lib/libmrclient.a $(MR_LIBDEP)
 	$(CC) -o $@ $(LDFLAGS) $(OBJS) $(LIBS)
Index: clients/mitch/Makefile.in
===================================================================
--- clients/mitch/Makefile.in	2007-02-14 01:59:20.000000000 -0500
+++ clients/mitch/Makefile.in	2007-02-14 01:59:59.000000000 -0500
@@ -40,7 +40,7 @@
 depend:
 
 install: all
-	$(INSTALL_PROGRAM) mitch $(bindir)
+	$(INSTALL_PROGRAM) mitch $(DESTDIR)$(bindir)
 
 $(TARGET): $(OBJS) ../lib/libmrclient.a $(MR_LIBDEP)
 	$(CC) -o $@ $(LDFLAGS) $(OBJS) $(LIBS)
Index: clients/moira/Makefile.in
===================================================================
--- clients/moira/Makefile.in	2007-02-14 01:59:20.000000000 -0500
+++ clients/moira/Makefile.in	2007-02-14 02:07:47.000000000 -0500
@@ -44,14 +44,14 @@
 depend:
 
 install: all
-	$(INSTALL_PROGRAM) namespace $(bindir)
-	$(INSTALL_PROGRAM) moira $(bindir)
-	rm -f $(bindir)/listmaint	
-	ln -s moira $(bindir)/listmaint
-	rm -f $(bindir)/dcmmaint
-	ln -s moira $(bindir)/dcmmaint
-	rm -f $(bindir)/usermaint
-	ln -s moira $(bindir)/usermaint
+	$(INSTALL_PROGRAM) namespace $(DESTDIR)$(bindir)
+	$(INSTALL_PROGRAM) moira $(DESTDIR)$(bindir)
+	rm -f $(DESTDIR)$(bindir)/listmaint
+	ln -s moira $(DESTDIR)$(bindir)/listmaint
+	rm -f $(DESTDIR)$(bindir)/dcmmaint
+	ln -s moira $(DESTDIR)$(bindir)/dcmmaint
+	rm -f $(DESTDIR)$(bindir)/usermaint
+	ln -s moira $(DESTDIR)$(bindir)/usermaint
 
 moira: $(MOBJS) ../lib/libmrclient.a $(MR_LIBDEP)
 	$(CC) -o $@ $(LDFLAGS) $(MOBJS) $(LIBS)
Index: clients/mrcheck/Makefile.in
===================================================================
--- clients/mrcheck/Makefile.in	2007-02-14 01:59:20.000000000 -0500
+++ clients/mrcheck/Makefile.in	2007-02-14 01:59:59.000000000 -0500
@@ -40,7 +40,7 @@
 depend:
 
 install: all
-	$(INSTALL_PROGRAM) mrcheck $(bindir)
+	$(INSTALL_PROGRAM) mrcheck $(DESTDIR)$(bindir)
 
 $(TARGET): $(OBJS) ../lib/libmrclient.a $(MR_LIBDEP)
 	$(CC) -o $@ $(LDFLAGS) $(OBJS) $(LIBS)
Index: clients/mrtest/Makefile.in
===================================================================
--- clients/mrtest/Makefile.in	2007-02-14 01:59:21.000000000 -0500
+++ clients/mrtest/Makefile.in	2007-02-14 01:59:59.000000000 -0500
@@ -40,7 +40,7 @@
 depend:
 
 install: all
-	$(INSTALL_PROGRAM) mrtest $(bindir)
+	$(INSTALL_PROGRAM) mrtest $(DESTDIR)$(bindir)
 
 $(TARGET): $(OBJS) ../lib/libmrclient.a $(MR_LIBDEP)
 	$(CC) -o $@ $(LDFLAGS) $(OBJS) $(LIBS)
Index: clients/stanley/Makefile.in
===================================================================
--- clients/stanley/Makefile.in	2007-02-14 01:59:21.000000000 -0500
+++ clients/stanley/Makefile.in	2007-02-14 01:59:59.000000000 -0500
@@ -40,7 +40,7 @@
 depend:
 
 install: all
-	$(INSTALL_PROGRAM) stanley $(bindir)
+	$(INSTALL_PROGRAM) stanley $(DESTDIR)$(bindir)
 
 $(TARGET): $(OBJS) ../lib/libmrclient.a $(MR_LIBDEP)
 	$(CC) -o $@ $(LDFLAGS) $(OBJS) $(LIBS)
Index: clients/stella/Makefile.in
===================================================================
--- clients/stella/Makefile.in	2007-02-14 01:59:21.000000000 -0500
+++ clients/stella/Makefile.in	2007-02-14 02:00:00.000000000 -0500
@@ -40,7 +40,7 @@
 depend:
 
 install: all
-	$(INSTALL_PROGRAM) stella $(bindir)
+	$(INSTALL_PROGRAM) stella $(DESTDIR)$(bindir)
 
 $(TARGET): $(OBJS) ../lib/libmrclient.a $(MR_LIBDEP)
 	$(CC) -o $@ $(LDFLAGS) $(OBJS) $(LIBS)
Index: man/Makefile.in
===================================================================
--- man/Makefile.in	2007-02-14 01:59:21.000000000 -0500
+++ man/Makefile.in	2007-02-14 02:00:00.000000000 -0500
@@ -32,6 +32,7 @@
 depend:
 
 install:
-	for m in $(MAN1); do $(INSTALL_DATA) $(srcdir)/$$m $(mandir)/man1; done
-	for m in $(MAN3); do $(INSTALL_DATA) $(srcdir)/$$m $(mandir)/man3; done
-	for m in $(MAN8); do $(INSTALL_DATA) $(srcdir)/$$m $(mandir)/man8; done
+	$(srcdir)/../mkinstalldirs $(DESTDIR)$(mandir)/man1 $(DESTDIR)$(mandir)/man3 $(DESTDIR)$(mandir)/man8
+	for m in $(MAN1); do $(INSTALL_DATA) $(srcdir)/$$m $(DESTDIR)$(mandir)/man1; done
+	for m in $(MAN3); do $(INSTALL_DATA) $(srcdir)/$$m $(DESTDIR)$(mandir)/man3; done
+	for m in $(MAN8); do $(INSTALL_DATA) $(srcdir)/$$m $(DESTDIR)$(mandir)/man8; done
Index: update/Makefile.in
===================================================================
--- update/Makefile.in	2007-02-14 01:59:21.000000000 -0500
+++ update/Makefile.in	2007-02-14 02:00:00.000000000 -0500
@@ -43,8 +43,8 @@
 depend:
 
 install: all
-	$(INSTALL_PROGRAM) update_test $(bindir)
-	$(INSTALL_PROGRAM) update_server $(sbindir)
+	$(INSTALL_PROGRAM) update_test $(DESTDIR)$(bindir)
+	$(INSTALL_PROGRAM) update_server $(DESTDIR)$(sbindir)
 
 update_test: $(COBJS) $(MR_LIBDEP)
 	$(CC) -o $@ $(LDFLAGS) $(COBJS) $(LIBS)
--- configure.in.orig	2006-05-12 16:26:10.000000000 -0400
+++ configure.in	2007-12-18 15:53:40.000000000 -0500
@@ -1,6 +1,6 @@
 AC_INIT(patchlevel.h)
 
-dnl On Athena at least, many of the packages (krb, zephyr, hesiod, etc)
+dnl On Athena at least, many of the packages (krb, hesiod, etc)
 dnl will all be in /usr/athena... this hack lets us not end up with 10
 dnl copies of -I/usr/athena/include -L/usr/athena/lib in our command lines
 AC_DEFUN(MR_EXTEND, [
@@ -115,17 +115,16 @@
     [  --with-krb4=PREFIX      Specify location of krb4],
     [krb4="$withval"], [krb4=no])
 AC_MSG_RESULT($krb4)
-if test $krb4 = "no"; then
-    AC_MSG_ERROR(Kerberos is required for Moira)
-fi
-if test "$krb4" != yes; then
-    MR_INCLUDE($krb4/include)
-    if test -d "$krb4/include/kerberosIV"; then
-	MR_INCLUDE($krb4/include/kerberosIV)
+if test "$krb4" != no; then
+    if test "$krb4" != yes; then
+        MR_INCLUDE($krb4/include)
+        if test -d "$krb4/include/kerberosIV"; then
+        MR_INCLUDE($krb4/include/kerberosIV)
+        fi
+        MR_LIBS($krb4/lib)
+    elif test -d /usr/include/kerberosIV; then
+        MR_INCLUDE(/usr/include/kerberosIV)
     fi
-    MR_LIBS($krb4/lib)
-elif test -d /usr/include/kerberosIV; then
-    MR_INCLUDE(/usr/include/kerberosIV)
 fi
 AC_CHECK_LIB(k5crypto, main, crypto="k5crypto",
              [AC_CHECK_LIB(crypto, main, crypto="crypto")])
@@ -143,20 +142,26 @@
     [krb5="$withval"], [krb5=no])
 AC_MSG_RESULT($krb5)
 if test "$krb5" != no; then
-    REG_SVR_DEFS=-DKRB5
     if test "$krb5" != yes; then
-	REG_SVR_INCLUDES=-I$krb5/include
-	REG_SVR_LIBS=-L$krb5/lib
+        REG_SVR_DEFS=-DKRB5
+        if test "$krb5" != yes; then
+        REG_SVR_INCLUDES=-I$krb5/include
+        REG_SVR_LIBS=-L$krb5/lib
+        fi
+        REG_SVR_LIBS="$REG_SVR_LIBS -lkadm5clnt -lgssapi_krb5 -lgssrpc -lkrb4 -ldes425 -lkrb5 -l${crypto} -lresolv"
+    else
+        REG_SVR_DEFS=-DKRB4
+        REG_SVR_LIBS=-lkadm
     fi
-    REG_SVR_LIBS="$REG_SVR_LIBS -lkadm5clnt -lgssapi_krb5 -lgssrpc -lkrb4 -ldes425 -lkrb5 -l${crypto} -lresolv"
-else
-    REG_SVR_DEFS=-DKRB4
-    REG_SVR_LIBS=-lkadm
 fi
 AC_SUBST(REG_SVR_DEFS)
 AC_SUBST(REG_SVR_INCLUDES)
 AC_SUBST(REG_SVR_LIBS)
 
+if test $krb5 = "no" -a $krb4 = "no"; then
+    AC_MSG_ERROR(Kerberos is required for Moira)
+fi
+
 # Hesiod support
 AC_MSG_CHECKING(for Hesiod)
 AC_ARG_WITH(hesiod,
@@ -176,23 +181,6 @@
     MR_DEFINE(HAVE_HESIOD)
 fi
 
-# Zephyr support
-AC_MSG_CHECKING(for Zephyr)
-AC_ARG_WITH(zephyr,
-    [  --with-zephyr=PREFIX    Specify location of Zephyr],
-    [zephyr="$withval"], [zephyr=no])
-AC_MSG_RESULT($zephyr)
-if test "$zephyr" != no; then
-    if test "$zephyr" != yes; then
-	MR_INCLUDE($zephyr/include)
-	MR_LIBS($zephyr/lib)
-    fi
-    AC_CHECK_LIB(zephyr, ZInitialize, :,
-		 [AC_MSG_ERROR(Zephyr library not found)],
-		 $LIBPATH $KRB4_LIBS -lcom_err)
-    MR_DEFINE(HAVE_ZEPHYR)
-fi
-
 # RSAREF support (default: build util/rsaref if present)
 AC_MSG_CHECKING(for RSAREF)
 AC_ARG_WITH(rsaref,
@@ -449,7 +437,7 @@
 MR_INCLUDE('$(BUILDTOP)/db')
 MR_INCLUDE('$(srcdir)')
 LDFLAGS="$LDFLAGS -L\$(BUILDTOP)/lib $LIBPATH"
-KLIBS="-lzephyr $KRB4_LIBS -lcom_err -lhesiod $LIBS"
+KLIBS="$KRB4_LIBS -lcom_err -lhesiod $LIBS"
 LIBS="-lmoira $KLIBS"
 AC_SUBST(KLIBS)
 
